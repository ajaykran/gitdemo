SELECT * FROM EMMT_DM.TASK_V;

SELECT * FROM DM_EXCLUSION_REF;

SELECT * FROM EMMT_APP.MIG_BATCH_LIST;

SELECT * FROM ALL_TABLES WHERE TABLE_NAME LIKE '%DM_EXC%';

SELECT * FROM EMMT_DM.OFSLL_TRANSFORM_EXCLUDE_DEF
WHERE ACTIVE='Y';

SELECT * FROM EMMT_DM.DM_EXCLUSION_REF
WHERE ACTIVE='Y' ;



SELECT * FROM EMMT_DM.JOB_DETAIL
WHERE ENABLED_YN='N';

SELECT * FROM EMMT_APP.DAEMON_CONFIG;

SELECT * FROM EMMT_DM.TASK_V;

----DATAMART VALIDATIONS ---------------

SELECT COUNT(*) COUNT, EXCLUSION_LIST
FROM 
(SELECT
  PKG_DM_UTIL.GET_EXCLUSION_LIST_F(EXCLUSION_ID) AS EXCLUSION_LIST
, A.EIP_EQUIPMENT_ID,BAN
FROM EMMT_DG.DM_NFS_ONE_TABLE A)
GROUP BY EXCLUSION_LIST
ORDER BY 1 DESC;

select count(*), ban_status
from dm_samson_fact
where ban in 
(select ban from cr_dm_rejects_lc122
where exclusion_list like '%|22|%')
group by ban_status; -- 43139	N

select * from eip_adm.bill_cycle@nfs_eip.UNIX.GSM1900.ORG;

select * from eip_bill_cycle;

select * from user_db_links;

--------- LOCK VALIDATIONS ----------
---EXPECTED BANS LOCKED  : 
SELECT COUNT(DISTINCT BAN) FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=221
AND (REJECT_LIST NOT IN ('X') OR REJECT_LIST IS NULL); 

---EXPECTED LOANS LOCKED
SELECT COUNT(EIP_EQUIPMENT_ID) FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=221
AND (REJECT_LIST NOT IN ('X') OR REJECT_LIST IS NULL); 

----ACTUAL BANS LOCKED
SELECT COUNT(*) FROM EIP_LOCK@NFS_EIP WHERE BAN IN
(SELECT DISTINCT BAN FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=221
AND (REJECT_LIST NOT IN ('X') OR REJECT_LIST IS NULL)); 

----ACTUAL LOANS LOCKED
SELECT * FROM EIP_EQUIPMENT@NFS_EIP WHERE ID IN
(SELECT EIP_EQUIPMENT_ID FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=221
AND STATUS='Locked-Migrating');
AND (REJECT_LIST NOT IN ('X') OR REJECT_LIST IS NULL));

---------- ETL REJECTS AND EXCLUSIONS -----------
SELECT BATCH_ID
     , LIST_ID
     , CONSUMER_NAME
     , ERROR_CODE
     , COUNT(*) COUNT
     ,DESCRIPTION 
  FROM
       (
         SELECT 
               MBE.BATCH_ID
             , MBLO.LS_NAME
             , MBLO.LIST_ID
             , C.CONSUMER_ID
             , MBLO.CONSUMER_NAME
             , MBLO.FILE_BASENAME
             , MBE.MIG_BATCH_LOG_ID
             , MBE.EIP_EQUIPMENT_ID
             , MBE.ERROR_TYPE
             , MBE.ERROR_CODE
             , CE.DESCRIPTION||MBE.ERROR_STRING AS DESCRIPTION
          FROM EMMT_BB.MIG_BATCH_EXCEPTION MBE
          JOIN EMMT_BB.MIG_BATCH_LOG MBLO
            ON MBLO.MIG_BATCH_LOG_ID = MBE.MIG_BATCH_LOG_ID
          JOIN EMMT_BB.CONSUMER C
            ON MBLO.CONSUMER_NAME = C.CONSUMER_NAME
          LEFT 
          JOIN EMMT_BB.CONSUMER_EXCEPTION CE
            ON CE.CONSUMER_ID = C.CONSUMER_ID
           AND CE.REASON_CODE = MBE.ERROR_CODE
       )
WHERE BATCH_ID IN (220)
GROUP BY BATCH_ID
        , LIST_ID
        , CONSUMER_NAME
        , ERROR_CODE
        ,DESCRIPTION
ORDER BY COUNT(*) DESC;

CREATE TABLE LC1_CHECK2 AS 
SELECT * FROM EMMT_APP.MIG_BATCH_LIST 
WHERE EIP_EQUIPMENT_ID IN
(SELECT  EIP_EQUIPMENT_ID
FROM EMMT_APP.MIG_BATCH_EXCEPTION 
WHERE BATCH_ID=201 AND ERROR_CODE=0);

CREATE TABLE LC1_CHECK3 AS 
SELECT * FROM EMMT_APP.MIG_BATCH_LIST 
WHERE EIP_EQUIPMENT_ID IN
(SELECT  EIP_EQUIPMENT_ID
FROM EMMT_APP.MIG_BATCH_EXCEPTION 
WHERE BATCH_ID=201); 

SELECT COUNT(DISTINCT BAN) 
FROM LC1_CHECK3;



CREATE TABLE LC1_CHECK4 AS
SELECT COUNT(*) COUNT, BAN
FROM LC1_CHECK3
GROUP BY BAN;

SELECT * FROM 
LC1_CHECK4;

CREATE TABLE LC1_CHECK5 AS 
SELECT COUNT(*) COUNT1, D1.BAN
FROM 
DM_NFS_ON_DEMAND D1, LC1_CHECK4 L1
WHERE L1.BAN=D1.BAN
GROUP BY D1.BAN;

SELECT COUNT(*) FROM 
LC1_CHECK4 L1, LC1_CHECK5 L2
WHERE L1.BAN=L2.BAN
AND COUNT1!=COUNT;

DROP TABLE LC1_CHECK5 PURGE;

SELECT EXCLUDED_IN_DM
     , BAN_EXCLUDED_PER_SIBLING
     , INCLUDED_IN_PRIOR_BATCH
     , COUNT(*) AS LOANS
FROM
(
SELECT CASE WHEN EXCLUSION_ID = 0 THEN 'N' ELSE 'Y' END AS EXCLUDED_IN_DM
     , CASE WHEN DM_NFS_OT_BAN_EXCLUDE.BAN IS NOT NULL THEN 'Y' ELSE 'N' END AS BAN_EXCLUDED_PER_SIBLING
     , CASE WHEN NVL(FAILED_ATTEMPTS,0) = 0 THEN 'N' ELSE 'Y' END AS INCLUDED_IN_PRIOR_BATCH
  FROM EMMT_DM.DM_NFS_ONE_TABLE
  LEFT
  JOIN EMMT_DM.DM_NFS_OT_BAN_EXCLUDE
    ON DM_NFS_ONE_TABLE.BAN = DM_NFS_OT_BAN_EXCLUDE.BAN
 WHERE 1=1
)
GROUP BY EXCLUDED_IN_DM
       , BAN_EXCLUDED_PER_SIBLING
       , INCLUDED_IN_PRIOR_BATCH
ORDER BY 1,2,3; 

-------------------API TABLES VALIDATIONS --------------- COUNT TO MATCH WITH BRONZE LIST 
SELECT COUNT(*)
FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=201
AND (REJECT_LIST NOT IN ('X') OR REJECT_LIST IS NULL); ---- 6190869 

SELECT COUNT(*)
FROM EMMT_DM.API_ACCOUNTS; ---- 6190919

CREATE TABLE LC1_CHECK1 AS 
SELECT *
FROM EMMT_DM.API_ACCOUNTS 
WHERE ACC_APP_ORIG_SYS_XREF NOT IN
(SELECT EIP_EQUIPMENT_ID
FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=201
AND (REJECT_LIST NOT IN ('X') OR REJECT_LIST IS NULL)); ---- 6190869 


SELECT * FROM EMMT_APP.MIG_BATCH_EXCEPTION
WHERE EIP_EQUIPMENT_ID IN
(SELECT ACC_APP_ORIG_SYS_XREF FROM LC1_CHECK1);

SELECT EIP_EQUIPMENT_ID
FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=201 
AND EIP_EQUIPMENT_ID IN
(174485102,
174485082,
174484972,
174481139,
174481133,
174485010);

SELECT COUNT(*), ACC_APP_ORIG_SYS_XREF
FROM API_ACCOUNTS
GROUP BY ACC_APP_ORIG_SYS_XREF
HAVING COUNT(1) > 1;

SELECT COUNT(*)
FROM API_CONTRACTS; ---- 6190869

SELECT COUNT(*)
FROM API_ACCOUNT_BALANCES; ---- 6191183

SELECT COUNT(*)
FROM API_ASSETS; ---- 6190919

SELECT COUNT(*)
FROM API_AGREEMENTS; ---- 4143819

SELECT COUNT(DISTINCT INSTALLMENT_PLAN_ID)
FROM EMMT_APP.MIG_BATCH_LIST 
WHERE BATCH_ID=201; --- 4143771

-----COUNT OF REPAYMENT SCHEDULE -----
CREATE TABLE LC1_EIP_CHARGE_REPMT_SCHED1 AS
SELECT COUNT(1) COUNT_EID,EIP_EQUIPMENT_ID, CHARGE_AMOUNT, MIN(DUE_DATE) MIN_DUE_DATE, MIN(PAYMENT_NUMBER) MIN_PAYMENT_NUMBER
FROM EIP_CHARGE
WHERE PROCESSED_INDICATOR='N'
AND CHARGE_TYPE='regular_charge'
GROUP BY EIP_EQUIPMENT_ID, CHARGE_AMOUNT, EXTRACT(DAY FROM DUE_DATE);

SELECT COUNT(DISTINCT EIP_EQUIPMENT_ID)
FROM LC1_EIP_CHARGE_REPMT_SCHED1; --- 5876885

SELECT COUNT(DISTINCT ACP_APP_ORIG_SYS_XREF)
FROM API_ACCOUNT_REPMT_SCHEDULE; --- 5876885

------PROMO MIGRATION ----
SELECT COUNT(*) 
FROM PROMO_DRIVER; --- 2639432

----STAGING TABLES ----
SELECT COUNT(*) FROM AWARD_MIGRATION_STAGING@NFS_PROMO
WHERE AWARD_ID IN (SELECT AWARD_ID FROM PROMO_DRIVER) ; --- 2639428

SELECT COUNT(*) FROM AWARD_CHARGE_MIGRATION_STAGING@NFS_PROMO
WHERE LOAN_ID IN (SELECT AWARD_ID FROM PROMO_DRIVER) ; --- 688645 

SELECT COUNT(*) FROM ERR_AWARD_MIGRATION_STAGING; -- 4

SELECT COUNT(*) FROM ERR_AWARD_CHARGE_MIG_STAGING; -- 0

---- PROMO API ------
SELECT COUNT(1), TRANSLATE(FAIL_REASON, '0123456789','----------') REASON
FROM PROMO_RESPONSE
GROUP BY TRANSLATE(FAIL_REASON, '0123456789','----------')
ORDER BY 2 DESC;

--- PROMOS IN LPA ---
SELECT  COUNT(*) FROM LOAN_AWARD@NFS_PROMO
WHERE AWARD_ID IN (SELECT AWARD_ID  FROM PROMO_RESPONSE WHERE FAIL_REASON='Award Migrated');  --2639343

SELECT  COUNT(*)  FROM LOAN_AWARD@NFS_PROMO WHERE AWARD_ID IN (SELECT AWARD_ID FROM PROMO_DRIVER);  --2639343 

SELECT COUNT(AWARD_ID) FROM LOAN_AWARD_MAPPER@NFS_PROMO 
WHERE AWARD_ID IN (SELECT AWARD_ID  FROM PROMO_DRIVER); --- 2639343

SELECT COUNT(DISTINCT AWARD_ID) FROM LOAN_AWARD_EVENT_STORE@NFS_PROMO 
WHERE AWARD_ID IN (SELECT AWARD_ID FROM PROMO_DRIVER);  --- 2969164, DISTINCT 2639343

SELECT COUNT(*) 
FROM LOAN_AWARD@NFS_PROMO
WHERE ACTIVE='Y'
AND REMAINING_CREDIT_AMOUNT > 0
AND AWARD_ID IN (SELECT AWARD_ID FROM PROMO_DRIVER); -- 2451333

SELECT COUNT(DISTINCT LOAN_ID) FROM LOAN_AWARD_FINANCIAL_ACTIVITY@NFS_PROMO
WHERE LOAN_ID IN (SELECT AWARD_ID  FROM PROMO_DRIVER); ---- 2451333

SELECT COUNT(LOAN_ID) FROM LOAN_AWARD_ACCOUNT_TRANSACTION@NFS_PROMO
WHERE LOAN_ID IN (SELECT AWARD_ID FROM PROMO_DRIVER ); --- 2451333

SELECT COUNT(LOAN_ID) FROM LOAN_AWARD_AR_DI_REPORTING@NFS_PROMO
WHERE LOAN_ID IN (SELECT AWARD_ID FROM PROMO_DRIVER); --- 2451333

SELECT COUNT(LOAN_ID) FROM LOAN_AWARD_REPORTING@NFS_PROMO 
WHERE LOAN_ID IN (SELECT AWARD_ID FROM PROMO_DRIVER ); --- 2451333

SELECT COUNT(*) 
FROM LOAN_AWARD@NFS_PROMO
WHERE ACTIVE='N'
AND REMAINING_CREDIT_AMOUNT <=0; -- 500


---UNLOCK VALIDATIONS 
SELECT COUNT(*) FROM EMMT_APP_3.MIG_BATCH_LIST
WHERE REJECT_LIST NOT IN ('X') 
AND REJECT_LIST IS NOT NULL;

SELECT * FROM EIP_ADM.EIP_LOCK@NFS_EIP
WHERE BAN IN (SELECT DISTINCT BAN FROM EMMT_APP_3.MIG_BATCH_LIST
WHERE  REJECT_LIST NOT IN ('X') 
AND REJECT_LIST IS NOT NULL);

SELECT COUNT(*) FROM EIP_ADM01.EIP_EQUIPMENT@NFS_EIP
WHERE ID IN (SELECT EIP_EQUIPMENT_ID FROM EMMT_APP_3.MIG_BATCH_LIST
WHERE  REJECT_LIST NOT IN ('X') 
AND REJECT_LIST IS NOT NULL);

--------BRIDGING VALIDATIONS ------------
SELECT COUNT(distinct EQUIPMENTFINANCEID )
FROM DFS_BRIDGE_ADM.INSTALLMENT_SYSTEM_NAME@NFS_GELDB
WHERE EQUIPMENTFINANCEID IN
(SELECT EIP_EQUIPMENT_ID FROM EMMT_APP.MIG_BATCH_LIST WHERE BATCH_ID=201 AND REJECT_LIST IS NULL)
AND CREATEDBY='MIGRATION'; ---- 6188534 -----6211493 

CREATE TABLE LC1_ULID_CHECKS_1 AS 
SELECT *
FROM DFS_BRIDGE_ADM.INSTALLMENT_SYSTEM_NAME@NFS_GELDB
WHERE EQUIPMENTFINANCEID IN
(SELECT EIP_EQUIPMENT_ID FROM EMMT_APP.MIG_BATCH_LIST WHERE BATCH_ID=201 AND REJECT_LIST IS NULL)
AND CREATEDBY='MIGRATION'; ---- Expected : 6188534 ----- Actual : 6211493 

SELECT *
FROM DFS_BRIDGE_ADM.INSTALLMENT_SYSTEM_NAME@NFS_GELDB
WHERE EQUIPMENTFINANCEID=145700987;
145700987
149177551
131746570
153154098
130832635
152735120
144923234

SELECT COUNT(*), EQUIPMENTFINANCEID
FROM LC1_ULID_CHECKS_1
GROUP BY EQUIPMENTFINANCEID
HAVING COUNT(1) > 1;


SELECT * FROM ULID_PHONE_REF@NFS_GELDB
WHERE ACCOUNT_NUMBER IN 
(SELECT DISTINCT BAN FROM EMMT_APP.MIG_BATCH_LIST 
WHERE BATCH_ID=201 AND REJECT_LIST IS NULL); ---- 3688155

--- EIP (SOURCE)
SELECT COUNT(DISTINCT CUSTOMER_ID) FROM EIP_ADM.INSTALLMENT_ACCOUNT_ECL@NFS_EIP.UNIX.GSM1900.ORG
WHERE CUSTOMER_ID IN 
(SELECT ID FROM EIP_INSTALLMENT_ACCOUNT WHERE BAN IN 
(SELECT DISTINCT BAN FROM EMMT_APP.MIG_BATCH_LIST WHERE BATCH_ID=201 AND REJECT_LIST IS NULL))
AND ACTIVE='Y'; -- 238 DISTINCT ROWS , 242 ACTIVE ROWS.

SELECT COUNT(DISTINCT BAN)
FROM EMMT_APP.MIG_BATCH_LIST WHERE BATCH_ID=201 AND REJECT_LIST IS NULL; -- 1746063

select * from user_db_links;
--- TARGET (GEL DB)

SELECT COUNT(*) FROM INSTALLMENT_ACCOUNT_ECL@NFS_GELDB
WHERE ACCOUNT_NUMBER IN
(SELECT DISTINCT BAN FROM EMMT_APP.MIG_BATCH_LIST WHERE BATCH_ID=201 AND REJECT_LIST IS NULL); -- 1746063
AND ECL IS NULL
AND CREATED_AT LIKE '<<DATE>>';

--- EIP
SELECT COUNT(*) FROM EIP_PAYMENT_LOG WHERE EIP_EQUIPMENT_ID IN 
(SELECT EIP_EQUIPMENT_ID FROM EMMT_APP.MIG_BATCH_LIST WHERE BATCH_ID = 201 AND REJECT_LIST IS NULL); --- 154552


--- TARGET (GEL DB)
SELECT COUNT(*) FROM DFS_PAYMENT_INFO@NFS_GELDB 
WHERE EQUIPMENTFINANCEID IN
(SELECT EIP_EQUIPMENT_ID FROM EMMT_APP.MIG_BATCH_LIST WHERE BATCH_ID=201 AND REJECT_LIST IS NULL); --- 154552

--------CLOSE VALIDATIONS -----------
SELECT COUNT(*) FROM CLOSE_DRIVER; --- 17992031

SELECT COUNT(*) FROM EMMT_APP.MIG_BATCH_LIST WHERE BATCH_ID=220
AND REJECT_LIST IS NULL;

SELECT * FROM TASK_V;

---------------FAT TABLE COUNTS VALIDATIONS -------
---- EIP CLOSE ---
SELECT COUNT(*)
FROM EIP_EQUIPMENT EE,CLOSE_DRIVER CD 
WHERE EE.ID=CD.EID
AND EE.STATUS IN
('Active', 'Active-Shipped', 'Active-Additional-Payment-Applied', 
                    'Active-Shipped-Additional-Payment-Applied', 'JUMP-Return-Pending');--- 17651603

SELECT COUNT(*) FROM 
FINANCIAL_ACTIVITY_STAGING
WHERE ACTIVITY_DESCRIPTION LIKE 'Migration Complete'; --- 17651603

----- EIP DI OFFSET ----
SELECT COUNT(*)
FROM EIP_EQUIPMENT EE,CLOSE_DRIVER CD 
WHERE EE.ID=CD.EID
AND EE.UNEARNED_INTEREST!=CD.DEFERRED_INTEREST
AND EE.STATUS IN
('Active', 'Active-Shipped', 'Active-Additional-Payment-Applied', 
                    'Active-Shipped-Additional-Payment-Applied', 'JUMP-Return-Pending');--- 15524445

SELECT COUNT(*) FROM 
FINANCIAL_ACTIVITY_STAGING
WHERE ACTIVITY_DESCRIPTION LIKE 'Conversion-DI-Offset'; --- 15524445

---- PROMO CLOSE ---
SELECT COUNT(*)
FROM EIP_EQUIPMENT EE,CLOSE_DRIVER CD , EIP_PROMO_REPORT EPR
WHERE EE.ID=CD.EID
AND EPR.DISCOUNTED_EQUIPMENT_ID=EE.ID
AND EE.STATUS IN
('Active', 'Active-Shipped', 'Active-Additional-Payment-Applied', 
                    'Active-Shipped-Additional-Payment-Applied', 'JUMP-Return-Pending')
OR (EE.STATUS LIKE '%Close%'
AND EPR.REMAINING_BALANCE <> 0 
AND EPR.ACTIVE = 'Y'); ------ ???

SELECT COUNT(*) 
FROM 
FINANCIAL_ACTIVITY_STAGING
WHERE ACTIVITY_DESCRIPTION LIKE 'Migration Complete-P'; --- 2570586

CREATE TABLE LC1_PROMO_CLOSE AS
SELECT EE.ID, EE.STATUS, CD.*, EPR.REMAINING_BALANCE, EPR.ACTIVE
FROM EIP_EQUIPMENT EE,CLOSE_DRIVER CD , EIP_PROMO_REPORT EPR
WHERE EE.ID=CD.EID
AND EPR.DISCOUNTED_EQUIPMENT_ID=EE.ID
AND EE.STATUS IN
('Active', 'Active-Shipped', 'Active-Additional-Payment-Applied', 
                    'Active-Shipped-Additional-Payment-Applied', 'JUMP-Return-Pending')
OR (EE.STATUS LIKE '%Close%'
AND EPR.REMAINING_BALANCE <> 0 
AND EPR.ACTIVE = 'Y'); ------ ???

-----PROMO DI OFFSET--------
SELECT COUNT(*)
FROM PROMO_RESPONSE PR,PROMO_RECON PREC 
WHERE PREC.AWARD_ID=PR.AWARD_ID
AND PREC.IMPUTED_INTEREST_UNEARNED !=PR.NEW_DI
AND PREC.RECON_SOURCE_ID=1
AND PR.AWARD_ID IN
(SELECT ID FROM LC1_PROMO_CLOSE); --- 

SELECT COUNT(*) FROM 
FINANCIAL_ACTIVITY_STAGING
WHERE ACTIVITY_DESCRIPTION LIKE 'Conversion-DI-Offset-P'; --- 2451266

--------------FAT TABLE MAPPING VALIDATIONS -------
DROP TABLE LC1_FAT_MAPPING_1;

CREATE TABLE LC1_FAT_MAPPING_1 AS
SELECT FA.*, 
IP.START_DATE IP_START_DATE, IP.SAP_PROCESS_DATE IP_SAP_PROCESS_DATE, IP.SHIP_DATE IP_SHIP_DATE,IP.STATUS IP_STATUS,
IP.APPLICATION_ID IP_APPLICATION_ID, IP.TRANSACTION_ID IP_TRANSACTION_ID, IP.STATE IP_STATE, 
IP.SHIP_TO_STATE IP_SHIP_TO_STATE,IP.BILL_TO_STATE IP_BILL_TO_STATE,IP.CREDIT_CLASS IP_CREDIT_CLASS, 
IP.INSTALLMENT_PLAN_ID IP_INSTALLMENT_PLAN_ID, IP.INTEREST_RATE IP_INTEREST_RATE, IP.PAYMENT_METHOD IP_PAYMENT_METHOD,
IP.CHANNEL_TYPE IP_CHANNEL_TYPE,IP.REQUIRED_PAYMENTS IP_REQUIRED_PAYMENTS,
EE.TRANSACTION_TYPE EE_TRANSACTION_TYPE, EE.FINANCE_TYPE EE_FINANCE_TYPE, EE.ID EE_ID, EE.BUYOUT_FLAG EE_BUYOUT_FLAG,
EE.RESIDUAL EE_RESIDUAL , EE.ECLB EE_ECLB,EE.ECLB_TAX EE_ECLB_TAX, EE.RESIDUAL_TAX EE_RESIDUAL_TAX, 
EE.NON_TMO_DEVICE_INDICATOR EE_NON_TMO_DEVICE_INDICATOR -------, EPR.REMAINING_BALANCE EPR_REMAINING_BALANCE
FROM FINANCIAL_ACTIVITY_STAGING FA, EIP_INSTALLMENT_PLAN IP, CLOSE_DRIVER CD, EIP_EQUIPMENT EE ----- EIP_PROMO_REPORT EPR,
WHERE FA.EIP_EQUIPMENT_ID=EE.ID
-----AND EE.ID=EPR.DISCOUNTED_EQUIPMENT_ID
-----AND CD.BAN=EPR.BAN
AND IP.INSTALLMENT_PLAN_ID=FA.EIP_PLAN_ID
AND FA.BAN=CD.BAN;

SELECT * FROM 
LC1_FAT_MAPPING_1;

SELECT COUNT(*)
FROM LC1_FAT_MAPPING_1; -- 111617145
WHERE PLAN_CREATE_DATE=IP_START_DATE
AND SAP_PROCESSED_DATE=IP_SAP_PROCESS_DATE
AND EQUIPMENT_SHIP_DATE=IP_SHIP_DATE
AND EQUIPMENT_RETURN_DATE IS NULL
AND EIP_PROCESS_DATE LIKE '03-DEC%'-----SYSDATE
AND PLAN_STATUS=IP_STATUS
AND BATCH_FILE_NUMBER IS NULL
AND SALES_CHANNEL=IP_APPLICATION_ID
AND ORIGINATING_SYSTEM_TRANS_ID=IP_TRANSACTION_ID
AND RETAIL_STATE=IP_STATE
AND SHIP_TO_STATE=IP_SHIP_TO_STATE
AND BILL_TO_STATE=IP_BILL_TO_STATE
AND CREDIT_CLASS_AT_PLAN_SETUP=IP_CREDIT_CLASS
AND INTEREST_RATE=IP_INTEREST_RATE
AND CHARGE_TYPE IS NULL
AND PAYMENT_NUMBER IS NULL
AND PRINCIPAL_PRT_OF_PLAN_AMT= (PLAN_AMT - IMPUTED_INTEREST_OF_PLAN_AMT); ---- 16906433
IMPUTED_INTEREST_OF_PLAN_AMT
BALANCE_ACTIVITY
OUTSTANDING_BALANCE_DUE
PRINCIPAL_BALANCE
DEF_INTEREST_INCOME_BALANCE
SENT_TO_SAMSON_FOR_BLNG
PRINCIPAL_PRT_OF_SAMSON_BLNG
INTEREST_PRT_OF_SAMSON_BLNG
CREATED_AT
CREATED_BY
PAYMENT_METHOD
CHANNEL_TYPE
PAYMENT_TERMS
EIP_EQUIPMENT_ID
FINANCE_TYPE
BUYOUT_FLAG
BAL_ACTVY_AMT_RESIDUAL
BAL_ACTVY_AMT_DEVICE
TLA_WITH_RESIDUAL
TLA_NO_RESIDUAL
RESIDUAL_AMOUNT
FRP
GROSS_DOWN_PAYMENT_DEVICE
TOTAL_DEVICE_PAYMENT
MONTHLY_DEVICE_PAYMENT
ECLB_TAX_AMOUNT
RESIDUAL_TAX_AMOUNT
NON_TMO_DEVICE_INDICATOR
PROMO_CODE
EQUIPMENT_ECLB
DOWN_PAYMENT_COLLECTED_BY_TMO
ENROLLMENT_PROCESS_TYPE
------PLAN_AMT
IMPUTED_INTEREST_OF_PLAN_AMT
BALANCE_ACTIVITY
DEF_INTEREST_INCOME_BALANCE
AND ACQUISITION_AAL_UPGRADE=;

----- REVENUE_RECOGNITION ----------- SHOULD MATCH GOLD LOANS
SELECT COUNT(EIP_EQUIPMENT_ID) 
FROM EIP_ADM.REVENUE_RECOGNITION_STAGING@NFS_EIP
WHERE EIP_EQUIPMENT_ID IN 
(SELECT EIP_EQUIPMENT_ID FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=221 AND REJECT_LIST IS NULL)
AND EVENT_SUB_TYPE='Closed-Migration'; ------   18553330

------- VALIDATE EIP TABLES -----
SELECT ID, STATUS, ECLB,REMAINING_PAYMENTS,PERCENT_TOTAL, CLOSED_AT, UPDATED_AT,UPDATED_BY
FROM EIP_ADM.EIP_EQUIPMENT@NFS_EIP
WHERE ID IN
(SELECT EIP_EQUIPMENT_ID FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=221 AND REJECT_LIST IS NULL);

SELECT INSTALLMENT_PLAN_ID, STATUS, ECLB,RFA, REMAINING_PAYMENTS,UPDATED_AT,UPDATED_BY
FROM EIP_ADM.EIP_EQUIPMENT@NFS_EIP
WHERE INSTALLMENT_PLAN_ID IN
(SELECT INSTALLMENT_PLAN_ID FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=221 AND REJECT_LIST IS NULL);

SELECT EIP_EQUIPMENT_ID, PROCESSED_INDICATOR, UPDATED_AT,UPDATED_BY, CHARGE_AMOUNT,EQUIPMENT_REVENUE,INTEREST_REVENUE
FROM EIP_ADM.EIP_CHARGE@NFS_EIP 
WHERE CHARGE_TYPE='regular_charge'
AND EIP_EQUIPMENT_ID IN
(SELECT EIP_EQUIPMENT_ID FROM EMMT_APP.MIG_BATCH_LIST
WHERE BATCH_ID=221 AND REJECT_LIST IS NULL);

select * from all_tables where table_name like '%CLOSE_DRIVER%';

select count(*) from loan_award@nfs_promo; --- 4320013

select count(*) from promo_response
where fail_reason like 'Award Migrated';







SELECT COUNT(ID),STATUS,HISTORY_INSERT_DATE FROM EIP_ADM01.EIP_EQUIPMENT_HIST@NFS_EIP WHERE ID IN
(SELECT EIP_EQUIPMENT_ID FROM EMMT_APP_2.MIG_BATCH_LIST
WHERE  REJECT_LIST IS NULL AND BATCH_ID=204)
AND STATUS='CLOSED-MIGRATION'
GROUP BY STATUS,HISTORY_INSERT_DATE;


-----------------------
